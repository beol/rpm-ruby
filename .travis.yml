sudo: required
language: ruby
rvm:
- 2.3.1
env:
  matrix:
  - OS_TYPE=centos OS_VERSION=6
  global:
  - WORKDIR=/source
  - VERSION=2.3.1
services:
- docker
install:
- docker build -t rpm-git .
before_script:
- mkdir -p $(pwd)/rpmbuild/SOURCES
- curl -# -L -o $(pwd)/rpmbuild/SOURCES/ruby-${VERSION}.tar.gz https://cache.ruby-lang.org/pub/ruby/2.3/ruby-${VERSION}.tar.gz
script:
- test "${TRAVIS_BRANCH}" = "master" && RELEASE_VERSION="`date +%Y%m%d%H%M`.`git rev-parse
  --short ${TRAVIS_BRANCH}`" || RELEASE_VERSION=""
- docker run --rm=true -v $(pwd):${WORKDIR}:rw -e "RELEASE_VERSION=${RELEASE_VERSION}"
  rpm-git bash ${WORKDIR}/build.sh
- docker run --rm=true -v $(pwd):${WORKDIR}:rw centos:${OS_TYPE}${OS_VERSION} bash
  -c "find /source -name \"*.rpm\" -type f | xargs -I{} yum -y localinstall {}"
